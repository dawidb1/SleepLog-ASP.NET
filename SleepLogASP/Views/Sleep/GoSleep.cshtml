@model SleepLogASP.Models.Sleep

@{
    ViewBag.Title = "GoSleep";
}

<link href="~/Content/Site.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/jquery-3.2.1.min.js"></script>
<script src="~/Scripts/jquery.flip.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>

<a href="@Url.Action("GetTime","Sleep")" id="postMePls">
<div id="card">
    <div id="startTime" class="front circle">
        <p id="saved-time" class="circle-text">Go to sleep</p>
    </div>
    <div id="stopTime" class="back circle">
        <p id="time" class="circle-text"></p>
    </div>
</div>
</a>

<div class="form-group">
    @Html.LabelFor(model => model.SleepTime.StartSleep, htmlAttributes: new { @class = "control-label col-md-2" })
    <div class="col-md-10">
        @Html.EditorFor(model => model.SleepTime.StartSleep, new { htmlAttributes = new { @class = "form-control" } })
        @*@Html.ValidationMessageFor(model => model.SleepTime.StartSleep, "", new { @class = "text-danger" })*@
    </div>
</div>


<script>
    $("#card").flip();

    var h, m, s, cs, ms, countStarted, czas;
    resetTime();
    countStarted = false;

    function resetTime() {
        czas = 0;
        h = 0;
        m = 0;
        s = 0;
        cs = 0;
    }

    function visibility() {
        document.getElementById('card').style.visibility = "visible";
    }

    function count() {
        cs++;

        if (cs === 100) {
            cs = 0;
            s++;

            if (s === 60) {
                s = 0;
                m++;

                if (m === 60) {
                    m = 0;
                    h++;
                }
            }
        }
        refresh();
    }

    function refresh() {

        czas = h + "h:" + m + "m:" + s + "s";
        var wyswietl = czas + "<br/> Stop";
        document.getElementById("time").innerHTML = wyswietl;
        //$("stopTime").innerHTML("Hello world!");
    }

    function startCount() {
        if (countStarted === false) {
            countStarted = true;
            visibility();
            setInterval(count, 10);
        }
        resetTime();
    }
    function stopCount() {
        document.getElementById("saved-time").innerHTML = "You slept:<br/> " + czas;
        //resetTime();
    }

    document.getElementById('startTime').onclick = startCount;
    document.getElementById('stopTime').onclick = stopCount;

    $("#postMePls").click(function (e) {

        e.preventDefault();
        $.ajax({

            url: $(this).attr("href"), // comma here instead of semicolon
            success: function () {
                alert("Value Added");  // or any other indication if you want to show
            }

        });

    });
</script>